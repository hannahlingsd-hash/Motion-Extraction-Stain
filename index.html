<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Wind-on-Wall â€” Ghosts + Stain (fixed)</title>

<style>
:root{
  --bg:#fff; --fg:#000; --mut:#333; --line:#000;
  --colR:320px;
  --track-fill:#111;
  --track-bg:#cfcfcf;
}
html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font:13px/1.45 Arial, Helvetica, sans-serif;}
body{overflow:hidden;}
*{box-sizing:border-box;}
.wrap{
  display:grid;
  grid-template-columns:minmax(0,1fr) var(--colR);
  gap:16px; height:100vh; padding:12px; overflow:hidden;
}
main{position:relative;display:flex;align-items:center;justify-content:center;min-width:0;}
.stage{
  position:relative;
  width:100%;
  height:100%;
  aspect-ratio:16/9;
  background:#000; /* restore black video area, no border lines */
  overflow:hidden;
}
canvas{
  position:absolute;inset:0;
  width:100%;height:100%;
  object-fit:contain;
  background:transparent;
  border:none;outline:none;
  display:block;
  transform:translateZ(0.001px);
}
aside.panel{
  padding:4px 14px 12px 4px;
  overflow:auto;
  scrollbar-width:thin;
}
aside.panel::-webkit-scrollbar{width:10px}
aside.panel::-webkit-scrollbar-thumb{background:#bbb}
aside.panel::-webkit-scrollbar-track{background:#eee}
.group{font-weight:700;margin:18px 0 6px}
.row{
  display:grid;align-items:center;gap:8px;margin:6px 0;
  grid-template-columns:1fr minmax(120px,1.6fr) 44px;
}
.row.compact{grid-template-columns:1fr auto 44px}
.row > span{text-align:right;color:#000}
.btnRow{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0}
.btn{appearance:none;background:#fff;color:#000;border:1px solid var(--line);padding:6px 10px;cursor:pointer}
.btn:disabled{opacity:.5;cursor:not-allowed}
.exportGrid{display:grid;gap:8px;margin:6px 0;grid-template-columns:1fr 1fr 1fr}
.exportGrid .full{grid-column:1 / -1}
input[type="range"]{
  appearance:none;height:2px;outline:none;
  background:linear-gradient(to right,var(--track-fill) 0 var(--p,0%),var(--track-bg) var(--p,0%) 100%);
}
input[type="range"]::-webkit-slider-thumb{appearance:none;width:10px;height:10px;background:#000;border:1px solid #000}
input[type="color"]{width:32px;height:22px;border:1px solid #000;background:#fff;padding:0}
.nosrc{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#888;font:12px ui-monospace;pointer-events:none;}
</style>
</head>

<body>
<div class="wrap">
  <main>
    <div class="stage">
      <video id="video" autoplay playsinline muted style="display:none"></video>
      <canvas id="final"></canvas>
      <div id="nosrc" class="nosrc">load a clip or use the webcam</div>
    </div>
  </main>

  <aside class="panel">
    <div class="group">Source</div>
    <div class="btnRow">
      <input id="file" type="file" accept="video/*">
    </div>
    <div class="btnRow">
      <button id="webcam" class="btn">Webcam</button>
      <button id="play" class="btn">Play/Pause</button>
      <button id="replay" class="btn">Replay</button>
    </div>
  </aside>
</div>

<script>
const video=document.getElementById('video');
const canvas=document.getElementById('final');
const ctx=canvas.getContext('2d');
const nosrc=document.getElementById('nosrc');
let webcamStream=null;

function resize(){
  canvas.width=canvas.clientWidth;
  canvas.height=canvas.clientHeight;
}
window.addEventListener('resize',resize);
resize();

function draw(){
  if(!video.paused && !video.ended){
    ctx.drawImage(video,0,0,canvas.width,canvas.height);
  }
  requestAnimationFrame(draw);
}
draw();

document.getElementById('file').onchange=e=>{
  const f=e.target.files[0];
  if(f){
    const url=URL.createObjectURL(f);
    video.src=url;
    video.style.display='block';
    nosrc.style.display='none';
  }
};

document.getElementById('play').onclick=()=>{
  if(video.paused)video.play();else video.pause();
};
document.getElementById('replay').onclick=()=>{
  video.currentTime=0;video.play();
};
document.getElementById('webcam').onclick=async()=>{
  if(webcamStream){webcamStream.getTracks().forEach(t=>t.stop());webcamStream=null;}
  webcamStream=await navigator.mediaDevices.getUserMedia({video:true});
  video.srcObject=webcamStream;
  video.style.display='block';
  nosrc.style.display='none';
  video.play();
};
</script>
</body>
</html>
