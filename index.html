<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>time inscriptions</title>
<style>
  :root{
    --bg:#0b0e12;           /* app background */
    --fg:#e6eeff;           /* app foreground (main area) */
    --mut:#90a1bb;
    --accent:#ff5b5b;

    /* sidebar (light) */
    --sb-bg:#ffffff;
    --sb-fg:#111111;
    --sb-muted:#666a73;
    --sb-border:#e8edf5;

    /* controls */
    --btn-bg:#f5f7fb;
    --btn-fg:#0e1116;
    --btn-border:#cfd7e3;
    --btn-bg-2:#ffffff;
    --btn-fg-2:#111111;
  }

  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font:14px/1.35 system-ui,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{display:grid;grid-template-columns:360px 1fr;gap:14px;height:100%}

  /* Sidebar: white, minimal, thin scrollbar */
  aside{
    padding:14px 12px 16px;
    border-right:1px solid var(--sb-border);
    overflow:auto;
    background:var(--sb-bg);
    color:var(--sb-fg);
    scrollbar-width:thin;                  /* Firefox */
    scrollbar-color:#cfd7e3 transparent;   /* Firefox */
  }
  aside::-webkit-scrollbar{width:6px;height:6px}                /* WebKit */
  aside::-webkit-scrollbar-track{background:transparent}
  aside::-webkit-scrollbar-thumb{background:#cfd7e3;border-radius:4px}

  main{position:relative}
  canvas{position:absolute;inset:0;width:100%;height:100%;object-fit:contain;background:#000}

  /* Typography in sidebar */
  h1{font-size:16px;margin:0 0 10px;letter-spacing:.2px;font-weight:600}
  fieldset{
    border:1px solid var(--sb-border);
    border-radius:6px;
    margin:10px 0;
    padding:10px
  }
  legend{padding:0 6px;color:#2f3b53;font-weight:600}
  .row{display:flex;align-items:center;gap:8px;margin:8px 0;flex-wrap:wrap}
  .row label{flex:1;color:var(--sb-muted)}
  .row input[type="range"], .row select{flex:2}

  /* Minimal rectangular buttons */
  .btn{
    appearance:none;
    border:1px solid var(--btn-border);
    background:var(--btn-bg);
    color:var(--btn-fg);
    border-radius:4px;           /* rectangular, not pill */
    padding:6px 10px;
    cursor:pointer;
    transition:background .15s ease,border-color .15s ease
  }
  .btn:hover{background:#e9eef7;border-color:#b9c6d9}
  .btn.secondary{
    background:var(--btn-bg-2);
    border-color:var(--btn-border);
    color:var(--btn-fg-2)
  }
  .btn.secondary:hover{background:#f7f9fc}

  .btn:disabled{opacity:.55;cursor:not-allowed}

  /* Inline UI bits (light) */
  .kbd{
    font:12px ui-monospace;
    background:#f1f4fa;
    border:1px solid #dfe6f0;
    border-radius:4px;
    padding:1px 6px;
    color:#2b3442
  }
  .small{font-size:12px;color:#6a7280}

  /* HUD & REC badges remain dark over the canvas */
  .hud{position:absolute;top:10px;left:10px;background:rgba(0,0,0,.45);padding:6px 8px;border-radius:8px;font:12px ui-monospace;white-space:pre}
  .rec{position:absolute;top:10px;right:10px;background:rgba(0,0,0,.55);padding:6px 10px;border-radius:10px;font:12px ui-monospace;display:flex;align-items:center;gap:8px}
  .dot{width:8px;height:8px;background:var(--accent);border-radius:50%;box-shadow:0 0 8px var(--accent)}
  .warn{color:#cc7a2b}
  .ok{color:#38a657}
  .nosrc{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#9aa7bd; font:12px ui-monospace; pointer-events:none}

  /* Floating Replay button: rectangular */
  .fab{
    position:absolute;top:46px;right:10px;z-index:5;
    border:1px solid var(--btn-border);
    background:var(--btn-bg);
    color:var(--btn-fg);
    border-radius:4px;
    padding:6px 10px;
    cursor:pointer
  }
  .fab:hover{background:#e9eef7;border-color:#b9c6d9}
</style>
</head>
<body>
<div class="wrap">
  <aside>
    <h1>time inscriptions</h1>
    <div class="row">
      <input id="file" type="file" accept="video/*">
      <button id="webcam" class="btn">Webcam</button>
      <button id="play" class="btn secondary">Play/Pause</button>
    </div>
    <div class="row">
      <button id="replay" class="btn secondary">↺ Replay</button>
      <span class="small">Shortcut: <span class="kbd">R</span></span>
    </div>
    <div class="row small">Or URL: <span class="kbd">?src=clip.mp4</span> (same-origin or CORS)</div>

    <fieldset>
      <legend>Temporal window</legend>
      <div class="row"><label>Δt (seconds)</label><input id="dt" type="range" min="2" max="10" step="0.5" value="6"><span id="dtV">6.0</span></div>
      <div class="row"><label>Diff threshold</label><input id="thr" type="range" min="4" max="60" value="18"><span id="thrV">18</span></div>
      <div class="row"><label>Grey level</label><input id="grey" type="range" min="60" max="200" value="120"><span id="greyV">120</span></div>
      <div class="row"><label>Pre-blur (px)</label><input id="preblur" type="range" min="0" max="3" value="0"><span id="preblurV">0</span></div>
    </fieldset>

    <fieldset>
      <legend>Ghosts (motion)</legend>
      <div class="row"><label>Ghost opacity</label><input id="gAlpha" type="range" min="0" max="1" step="0.05" value="0.7"><span id="gAlphaV">0.70</span></div>
      <div class="row"><label>Blend mode</label>
        <select id="gBlend">
          <option value="normal">Normal</option>
          <option value="screen" selected>Screen</option>
          <option value="lighter">Lighter (Add)</option>
          <option value="multiply">Multiply</option>
          <option value="difference">Difference</option>
        </select>
      </div>
      <div class="row">
        <label>Use custom color</label>
        <input id="gUseColor" type="checkbox">
        <input id="gColor" type="color" value="#ffffff">
      </div>
    </fieldset>

    <fieldset>
      <legend>Stain (residual blotches)</legend>
      <div class="row"><label>Enable stain</label><input id="stainOn" type="checkbox" checked></div>
      <div class="row"><label>Decay</label><input id="decay" type="range" min="0.90" max="0.995" step="0.001" value="0.970"><span id="decayV">0.970</span></div>
      <div class="row"><label>Strength</label><input id="strength" type="range" min="0.1" max="1" step="0.05" value="0.50"><span id="strengthV">0.50</span></div>
      <div class="row"><label>Expand (px)</label><input id="expand" type="range" min="0" max="8" step="1" value="2"><span id="expandV">2</span></div>
      <div class="row"><label>Stain color</label><input id="sColor" type="color" value="#223b7a"></div>
    </fieldset>

    <fieldset>
      <legend>Recall (resurface past traces)</legend>
      <div class="row">
        <label>Enable recall</label>
        <input id="recallOn" type="checkbox">
      </div>
      <div class="row">
        <label>Recall probability</label>
        <input id="recallProb" type="range" min="0" max="1" step="0.01" value="0.20">
        <span id="recallProbV">0.20</span>
      </div>
      <div class="row">
        <label>Recall capacity</label>
        <input id="recallCap" type="range" min="0" max="120" step="5" value="40">
        <span id="recallCapV">40</span>
      </div>
      <div class="row">
        <button id="recallNow" class="btn">Recall now</button>
      </div>
      <div class="row">
        <label>Recall color</label>
        <input id="recallColor" type="color" value="#00e7ff">
      </div>
      <div class="row">
        <label>Linger (s)</label>
        <input id="recallLinger" type="range" min="0.2" max="3" step="0.1" value="1.2">
        <span id="recallLingerV">1.2</span>
      </div>
      <div class="row">
        <label>Span (s)</label>
        <input id="recallSpan" type="range" min="0" max="3" step="0.1" value="0.8">
        <span id="recallSpanV">0.8</span>
      </div>
      <div class="row small">Recalls are tinted, linger with decay, and can replay a short past span.</div>
    </fieldset>

    <fieldset>
      <legend>Export</legend>
      <div class="row">
        <label>Format</label>
        <select id="format">
          <option value="mp4">MP4 (preferred)</option>
          <option value="webm">WebM</option>
          <option value="auto" selected>Auto (best available)</option>
        </select>
      </div>
      <div class="row">
        <button id="recStart" class="btn">Start Recording</button>
        <button id="recStop" class="btn" disabled>Stop & Save</button>
      </div>
      <div class="row">
        <button id="shot" class="btn secondary">Export PNG</button>
      </div>
      <div class="row">
        <button id="exportOne" class="btn">Export 1:1 (source)</button>
        <label style="flex:none;">Match preview look</label>
        <input id="matchPreview" type="checkbox" checked>
      </div>
      <div class="row small" id="supportNote"></div>
      <div class="row small" id="dbg">buffer: 0 | fps —</div>
    </fieldset>
  </aside>

  <main>
    <canvas id="stain"></canvas>
    <canvas id="ghost"></canvas>
    <canvas id="final"></canvas>
    <div id="hud" class="hud"></div>
    <div id="recHUD" class="rec" style="display:none;"><span class="dot"></span><span id="recTime">REC 00:00</span></div>
    <div id="nosrc" class="nosrc" style="display:none;">load a clip or use the webcam</div>
    <button id="replayFloat" class="fab" title="Replay (R)">↺</button>
  </main>
</div>

<!-- Your existing script tag stays the same; paste it here unchanged -->
<script>
/* … keep your entire JS exactly as-is … */
</script>
</body>
</html>
